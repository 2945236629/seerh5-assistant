{"version":3,"file":"PetBag.js","sources":["../src/module/PetBag.ts"],"sourcesContent":["import { Pet, SAEventBus, debounce, getImageButtonListener, hookFn, hookPrototype } from 'sa-core';\r\n\r\nclass PetBag implements SAMod.IModuleMod<petBag.PetBag> {\r\n    declare logger: typeof console.log;\r\n\r\n    meta: SAMod.MetaData = {\r\n        id: 'petBag',\r\n        scope: 'median',\r\n        type: 'module',\r\n        description: '精灵背包模块注入, 提供UI同步和本地皮肤功能的UI支持',\r\n    };\r\n\r\n    moduleName = 'petBag';\r\n    eventBus = new SAEventBus();\r\n    load() {\r\n        // 开启本地换肤按钮\r\n        hookPrototype(petBag.SkinView, 'onChooseSkin', function (f, ...args) {\r\n            f.call(this, ...args);\r\n            const skinId = this.arrayCollection.getItemAt(this.selectSkinIndex)?.id ?? 0;\r\n            if (skinId) {\r\n                this.btnPutOn.visible = skinId !== this.petInfo.skinId;\r\n                this.imgHasPutOn.visible = skinId === this.petInfo.skinId;\r\n            }\r\n        });\r\n    }\r\n    mainPanel(ctx: petBag.PetBag) {\r\n        const panel = ctx.panelMap['petBag.MainPanel'] as petBag.MainPanel;\r\n        const listener = getImageButtonListener(panel.btnIntoStorage);\r\n        hookFn(listener, 'callback', function (f) {\r\n            panel.beginPetInfo = panel.arrFirstPet[0].petInfo;\r\n            f.call(listener);\r\n            panel.beginPetInfo = null;\r\n        });\r\n        const initBagView = debounce(() => {\r\n            panel.initBagView();\r\n        }, 600);\r\n        const refresh = () => {\r\n            // 非ui操作, 是直接发包\r\n            if (panel.beginPetInfo == null && !petBag.ChangePetPop.changeFlag) {\r\n                initBagView();\r\n            }\r\n        };\r\n        const printTappingPetInfo = (e: egret.TouchEvent) => {\r\n            const { petInfo } = e.data as { petInfo: PetInfo };\r\n            petInfo && this.logger(new Pet(petInfo));\r\n        };\r\n        this.eventBus.socket(CommandID.PET_DEFAULT, refresh);\r\n        this.eventBus.socket(CommandID.PET_RELEASE, refresh);\r\n        this.eventBus.egret('petBag.MainPanelTouchPetItemEnd', printTappingPetInfo);\r\n    }\r\n    destroy() {\r\n        this.eventBus.unmount();\r\n    }\r\n}\r\n\r\nexport default PetBag;\r\n"],"names":["PetBag","__publicField","f","args","_a","skinId","ctx","panel","listener","initBagView","refresh","printTappingPetInfo","e","petInfo"],"mappings":";;;AAEA,MAAAA,EAAA;AAAA,EAAA;AAAwD,IAAAC,EAAA,cAAA;AAAA,MAG7B,IAAA;AAAA,MACf,OAAA;AAAA,MACG,MAAA;AAAA,MACD,aAAA;AAAA,IACO;AACjB,IAAAA,EAAA,oBAAA;AAEa,IAAAA,EAAA,kBAAA,IACE,IAAW;;EAAA,OAAA;AAGtB,QAAA,cAAA,OAAA,UAAA,gBAAA,SAAAC,MAAAC,GAAA;AAdR,UAAAC;AAeY,MAAAF,EAAA,KAAA,MAAA,GAAAC,CAAA;AACA,YAAAE,MAAAD,IAAA,KAAA,gBAAA,UAAA,KAAA,eAAA,MAAA,gBAAAA,EAAA,OAAA;AACA,MAAAC,MACI,KAAA,SAAA,UAAAA,MAAA,KAAA,QAAA,QACA,KAAA,YAAA,UAAAA,MAAA,KAAA,QAAA;AAAA,IACJ,CAAA;AAAA,EACH;AAAA,EACL,UAAAC,GAAA;AAEI,UAAAC,IAAAD,EAAA,SAAA,kBAAA,GACAE,IAAiB,IAAuB,uBAAAD,EAAA,cAAA;AACjC,QAAA,OAAAC,GAAA,YAAA,SAAAN,GAAA;AACH,MAAAK,EAAA,eAAAA,EAAA,YAAA,CAAA,EAAA,SACAL,EAAA,KAAAM,CAAA,GACAD,EAAA,eAAA;AAAA,IAAqB,CAAA;AAEzB,UAAAE,IAAoB;AAChB,MAAAF,EAAA,YAAA;AAAA,IAAkB,GAAA,GAAA,GAEtBG,IAAA,MAAA;AAEI,MAAAH,EAAA,gBAAA,QAAA,CAAA,OAAA,aAAA,cACIE;IACJ,GAEJE,IAAA,CAAAC,MAAA;AACI,YAAA,EAAA,SAAAC,EAAA,IAAAD,EAAA;AACA,MAAAC,KAAA,KAAA,OAAA,IAA2B,IAAA,IAAAA,CAAA,CAAA;AAAA,IAAY;AAE3C,SAAA,SAAA,OAAA,UAAA,aAAAH,CAAA,GACA,KAAA,SAAA,OAAA,UAAA,aAAAA,CAAA,GACA,KAAA,SAAA,MAAA,mCAAAC,CAAA;AAAA,EAA0E;AAAA,EAC9E,UAAA;AAEI,SAAA,SAAA;EAAsB;AAE9B;"}